
clear
clc

% DIMENSIONS
E = 114e9;

% table a lame
l1 = 0.0165;
b1 = 0.001;
h1 = 60e-6;

% mobile - table a lame
l2 = 0.0165;
b2 = 0.001;
h2 = 60e-6;

% roues
l3 = 0.011725;
b3 = 0.01;
h3 = 80e-6;
p = 0.000275; % centre d'attache interne roue
rext = 0.013; % rayon externe des roues

% pivots
lr = 0.015; % longeur des barres a liaison % 15mm voir plus grand genre 17mm
e = 50e-6; % epaisseur min pivots
rpiv = 0.002; % rayon de congé pivots
bpiv = 0.001; % profondeur

Ka = 3*E*b3*h3^3*(l3^2+3*p*l3+3*p^2)/l3^3/4;
Kp = 2*E*bpiv*e^2.5/9/pi/sqrt(rpiv);

% RESOLUTION
syms a b c d x y

a = 2*E*b1*h1^3/l1^3;
b = -12/pi^2/l1;
c = 2*E*b2*h2^3/l2^3;
d = -12/pi^2/l2;

B=[a;c;a];
A=[1,0,-b*y ; 0,1,-d*y ; 0,-b*x,1];
C=A\B;

%[X,Y] = meshgrid(-4e-3:0.5e-4:4e-3,-4e-3:0.5e-4:4e-3);
[X,Y] = meshgrid(1e-8:1e-4:4e-3,1e-8:1e-4:4e-3); % de 0 à 4mm

AX = asin(X/rext);
BX = asin(rext*(1-cos(AX))/lr);

%AX=X/rext;
%BX=0;

% k11=C(1);
% k21=C(2);
% k22=C(3);
% k12=a+b*k21*x;
C(1)
C(2)
C(3)

K11 = (256705178760118272*(1296335354819233*Y - 17592186044416))./...
    (1331*(1680485352154306718798106708289*X.*Y - 309485009821345068724781056));
K21 = (256705178760118272*(1296335354819233*Y - 17592186044416))./...
    (1331*(1680485352154306718798106708289*X.*Y - 309485009821345068724781056));
K22 = (256705178760118272*(1296335354819233*X - 17592186044416))./...
    (1331*(1680485352154306718798106708289*X.*Y - 309485009821345068724781056));



%{
K11 = (216594994578849792*(8555813341806937*Y - 140737488355328))./...
    (25*(73201941939841586981544181321969*X.*Y - 19807040628566084398385987584));
K21 = (216594994578849792*(8555813341806937*Y - 140737488355328))./...
    (25*(73201941939841586981544181321969*X.*Y - 19807040628566084398385987584));
K22 = (216594994578849792*(8555813341806937*X - 140737488355328))./...
    (25*(73201941939841586981544181321969*X.*Y - 19807040628566084398385987584));
%}

K12 = a+b*K21*X;

Keq = (2*Ka*AX.^2 + 4*Kp*BX.^2)./X.^2 + (K11+K21);
DKeq = gradient(Keq);

%surf(X,Y,K11);
%surf(X,Y,K21);
%surf(X,Y,K22);
%surf(X,Y,K12);

%C = double(DKeq<-0.2)+double(DKeq<0.2);

surf(X,Y,Keq);
%colormap([1,1,0 ; 1,0,0 ; 0,0,1 ; 1,0,1]);
colorbar;
%shading interp;


%plot(x, f);